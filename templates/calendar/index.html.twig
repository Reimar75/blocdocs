{% extends 'base.html.twig' %}
{% block body %}
	<div class="calendar" data-controller="calendar">
		<div class="filters grid grid-cols-2 border-b text-gray-700 uppercase py-2 text-sm fixed top-0 w-full bg-white">
			<div>Bloc Docs</div>
			<div class="text-right">
				<button data-action="click->calendar#fetch keydown.enter->calendar#fetch" data-url="{{ path('app_calendar_block_create') }}">+ Block</button>
			</div>
		</div>
		<div class="weeks">
			{% for week in weeks %}
				<div class="week">
					<h2>
						<span class="week-number">{{ week.start|date('W')}}</span>
						{{ week.start|date('M d.') ~ '-' ~ week.end|date('d.') }}
					</h2>
					{% if week.blocks is not empty %}
						{% for block in week.blocks %}
							<div class="grid !gap-0 mb-0.5 blocks" data-action="click->calendar#fetch keydown.enter->calendar#fetch" data-url="{{ path('app_calendar_block_edit', {block: block.block.id}) }}">
								{% if block.starts %}
									{% set gridStyle = 'grid-column-start: ' ~ block.starts ~ '; grid-column-end: 8;' %}
								{% elseif block.ends %}
									{% set gridStyle = 'grid-column-start: 1; grid-column-end: ' ~ (block.ends + 1) ~ ';' %}
								{% elseif block.overlaps %}
									{% set gridStyle = 'grid-column-start: 1; grid-column-end: 8;' %}
								{% elseif block.within is not empty %}
									{% set gridStyle = 'grid-column-start: ' ~ block.within.starts ~ '; grid-column-end: ' ~ (block.within.ends + 1) ~ ';' %}
								{% endif %}
								<div style="{{ gridStyle }}">
									<div class="progress-wrapper">
										<div class="progress">
											<div class="w-full {{ block.block.color }}">
												{{ block.block.name }}
												({{ block.block.dateFrom|date('d.m.') }}
												-
												{{ block.block.dateTo|date('d.m.') }})</div>
										</div>
									</div>
								</div>
							</div>
						{% endfor %}
					{% endif %}
					<div class="grid border-r border-b">
						{% for day in week.days %}
							{% set isToday = day|date('ymd') == " now"|date('ymd') %}
							{% set isFuture = day|date('ymd') > " now"|date('ymd') %}
							<div>
								<div tabindex="{{ loop.parent.loop.index }}" class="day{{ isFuture ? ' future' }}" {{ isToday ? 'id="today"' }} data-action="click->calendar#fetch keydown.enter->calendar#fetch" data-url="{{ path('app_calendar_event_create', {date: day|date('Y-m-d')}) }}" data-date="{{ day|date('Y-m-d') }}">
									<div class="grid !grid-cols-2 !gap-0">
										<div>
											<small class="font-light">{{ day|date('D, d.') }}</small>
										</div>
										<div class="text-right">
										{% if week.comments[day|date('Y-m-d')] is defined %}
											{% set comment = week.comments[day|date('Y-m-d')] %}
											<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-blue-600 hover:text-blue-700 inline-block" data-action="click->calendar#fetch" data-url="{{ path('app_calendar_comment_edit', {comment: comment.id }) }}">
												<path stroke-linecap="round" stroke-linejoin="round" d="M8.625 9.75a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375m-13.5 3.01c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.184-4.183a1.14 1.14 0 01.778-.332 48.294 48.294 0 005.83-.498c1.585-.233 2.708-1.626 2.708-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" />
											</svg>
										{% else %}
											<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-gray-200 hover:text-gray-500 inline-block" data-action="click->calendar#fetch" data-url="{{ path('app_calendar_comment_create', {date: day|date('Y-m-d')}) }}">
												<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 011.037-.443 48.282 48.282 0 005.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" />
											</svg>										
										{% endif %}
										</div>
									</div>									
									{% if events[day|date('Y-m-d')] is defined %}
										{% for event in events[day|date('Y-m-d')] %}
											<div class="font-medium flex flex-wrap event {{ event.color }}" data-action="click->calendar#fetch" data-url="{{ path('app_calendar_event_edit', {event: event.id}) }}">
												<span class="flex-none">{{ event.name }}</span>
												{% if event.time %}
													<span class="grow text-right">
														<span class="whitespace-nowrap">
															{{ event.time|minutes_to_hours }}
														</span>
													</span>
												{% endif %}
											</div>
										{% endfor %}
									{% endif %}
								</div>
							</div>
						{% endfor %}
					</div>
					{% if week.time > 0 %}
						<div class="progress-wrapper mt-0.5">
							<div class="progress">
								{% for color, data in week.colors %}
									<div style="width: {{ data.percentage }}%" class="hover-disable flex flex-col text-center whitespace-nowrap justify-center {{ color }}">
										{{ data.time|minutes_to_hours }}
									</div>
								{% endfor %}
								<div class="px-2 w-20 text-center whitespace-nowrap bg-gray-100 font-medium">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5 inline -mt-0.5 ">
										<path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
									</svg>
									{{ week.time|minutes_to_hours }}
								</div>
							</div>
						</div>
					{% endif %}
				</div>
			{% endfor %}
		</div>
		<div id="modal-calendar" class="modal hidden" role="dialog" aria-modal="true">
			<div class="overlay"></div>
			<div class="modal-wrapper">
				<div class="modal-inner">
					<div class="modal-content"></div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
